/*⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠟⠛⠛⠛⠋⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠙⠛⠛⠛⠿⠻⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠋⠀⠀⠀⠀⠀⡀⠠⠤⠒⢂⣉⣉⣉⣑⣒⣒⠒⠒⠒⠒⠒⠒⠒⠀⠀⠐⠒⠚⠻⠿⠿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⠏⠀⠀⠀⠀⡠⠔⠉⣀⠔⠒⠉⣀⣀⠀⠀⠀⣀⡀⠈⠉⠑⠒⠒⠒⠒⠒⠈⠉⠉⠉⠁⠂⠀⠈⠙⢿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⠇⠀⠀⠀⠔⠁⠠⠖⠡⠔⠊⠀⠀⠀⠀⠀⠀⠀⠐⡄⠀⠀⠀⠀⠀⠀⡄⠀⠀⠀⠀⠉⠲⢄⠀⠀⠀⠈⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⠋⠀⠀⠀⠀⠀⠀⠀⠊⠀⢀⣀⣤⣤⣤⣤⣀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠜⠀⠀⠀⠀⣀⡀⠀⠈⠃⠀⠀⠀⠸⣿⣿⣿⣿
⣿⣿⣿⣿⡿⠥⠐⠂⠀⠀⠀⠀⡄⠀⠰⢺⣿⣿⣿⣿⣿⣟⠀⠈⠐⢤⠀⠀⠀⠀⠀⠀⢀⣠⣶⣾⣯⠀⠀⠉⠂⠀⠠⠤⢄⣀⠙⢿⣿⣿
⣿⡿⠋⠡⠐⠈⣉⠭⠤⠤⢄⡀⠈⠀⠈⠁⠉⠁⡠⠀⠀⠀⠉⠐⠠⠔⠀⠀⠀⠀⠀⠲⣿⠿⠛⠛⠓⠒⠂⠀⠀⠀⠀⠀⠀⠠⡉⢢⠙⣿
⣿⠀⢀⠁⠀⠊⠀⠀⠀⠀⠀⠈⠁⠒⠂⠀⠒⠊⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⢀⣀⡠⠔⠒⠒⠂⠀⠈⠀⡇⣿
⣿⠀⢸⠀⠀⠀⢀⣀⡠⠋⠓⠤⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠄⠀⠀⠀⠀⠀⠀⠈⠢⠤⡀⠀⠀⠀⠀⠀⠀⢠⠀⠀⠀⡠⠀⡇⣿
⣿⡀⠘⠀⠀⠀⠀⠀⠘⡄⠀⠀⠀⠈⠑⡦⢄⣀⠀⠀⠐⠒⠁⢸⠀⠀⠠⠒⠄⠀⠀⠀⠀⠀⢀⠇⠀⣀⡀⠀⠀⢀⢾⡆⠀⠈⡀⠎⣸⣿
⣿⣿⣄⡈⠢⠀⠀⠀⠀⠘⣶⣄⡀⠀⠀⡇⠀⠀⠈⠉⠒⠢⡤⣀⡀⠀⠀⠀⠀⠀⠐⠦⠤⠒⠁⠀⠀⠀⠀⣀⢴⠁⠀⢷⠀⠀⠀⢰⣿⣿
⣿⣿⣿⣿⣇⠂⠀⠀⠀⠀⠈⢂⠀⠈⠹⡧⣀⠀⠀⠀⠀⠀⡇⠀⠀⠉⠉⠉⢱⠒⠒⠒⠒⢖⠒⠒⠂⠙⠏⠀⠘⡀⠀⢸⠀⠀⠀⣿⣿⣿
⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠑⠄⠰⠀⠀⠁⠐⠲⣤⣴⣄⡀⠀⠀⠀⠀⢸⠀⠀⠀⠀⢸⠀⠀⠀⠀⢠⠀⣠⣷⣶⣿⠀⠀⢰⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠁⢀⠀⠀⠀⠀⠀⡙⠋⠙⠓⠲⢤⣤⣷⣤⣤⣤⣤⣾⣦⣤⣤⣶⣿⣿⣿⣿⡟⢹⠀⠀⢸⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣧⡀⠀⠀⠀⠀⠀⠀⠀⠑⠀⢄⠀⡰⠁⠀⠀⠀⠀⠀⠈⠉⠁⠈⠉⠻⠋⠉⠛⢛⠉⠉⢹⠁⢀⢇⠎⠀⠀⢸⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⣀⠈⠢⢄⡉⠂⠄⡀⠀⠈⠒⠢⠄⠀⢀⣀⣀⣰⠀⠀⠀⠀⠀⠀⠀⠀⡀⠀⢀⣎⠀⠼⠊⠀⠀⠀⠘⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣄⡀⠉⠢⢄⡈⠑⠢⢄⡀⠀⠀⠀⠀⠀⠀⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠁⠀⠀⢀⠀⠀⠀⠀⠀⢻⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣦⣀⡈⠑⠢⢄⡀⠈⠑⠒⠤⠄⣀⣀⠀⠉⠉⠉⠉⠀⠀⠀⣀⡀⠤⠂⠁⠀⢀⠆⠀⠀⢸⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣦⣄⡀⠁⠉⠒⠂⠤⠤⣀⣀⣉⡉⠉⠉⠉⠉⢀⣀⣀⡠⠤⠒⠈⠀⠀⠀⠀⣸⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣶⣤⣄⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣶⣶⣶⣤⣤⣤⣤⣀⣀⣤⣤⣤⣶⣾⣿⣿⣿⣿⣿*/
//I want to go back throught this and make it into class
//But this is much easier
//this code SUCKS!!!!!!!!!!
//I dont want to go back and fix it
//And theres dumb fixes eveywhere
//this shit is so disorginzed

// Text variables to store and display game data
let HealthText;
let MoneyText;
let BasicTowerPrice;
let FPS;
let WaveText;

// Variables to store image directory and image objects
let HeartImageDirectory;
let HeartImageScreen;
let MoneyStackDirectory;
let MoneyStackScreen;

//shop buttons
let BasicTowerButton;
let SellButton;
let DeselectButton;
let PauseButton;
let FirstTargetButton;
let LastTargetButton;
let AntiTankTowerButton;
let SniperTowerButton;
let MachinegunTowerTowerButton;
let MissleLauncherButton;
let DroneTowerButton;
let WizardTowerButton;
let FreezeTowerButton;
let NinjaTowerButton;
let DamageTowerButton;
let RadarTowerButton;

//Price for the shop
let Price = {
  BasicTower: 150,
  SniperTower: 350,
  MachinegunTower: 600,
  MissleLauncherTower: 1200,
  Drone: 1500,
  Wizard: 600,
  FreezeTower: 500,
  NinjaTower: 600,
  DamageTower: 1500,
  RadarTower: 1500,
  AntiTankTower: 1500,
};

let ButtonColor;
let DisablePlacing = false;

//this function refreshes the tower data i guess??? (its is)
function RefreshText() {
  if (SelectedTower.Level < 4) {
    text(SelectedTower.Upgrade[SelectedTower.Level * 4 - 1], 585, 530);
  }
  text(SelectedTower.Name, 560, 430);
  text("Level: " + SelectedTower.Level, 680, 430);
  text(
    "Damage: " + SelectedTower.Damage * SelectedTower.DamageModifer,
    680,
    460
  );
  text("Speed: " + SelectedTower.AttackSpeed, 680, 490);
  text("Kills: " + SelectedTower.KillCount, 680, 520);
}

//the one good function
function UpgradeTower() {
  PlayClick();
  let index = SelectedTower.Level * 4;
  if (
    SelectedTower.Type == "Booster" &&
    GameMoney >= SelectedTower.Upgrade[index - 1]
  ) {
    for (let i = 0; i < PlacedTowers.length; i++) {
      if (
        PlacedTowers[i].BoostedBy.includes(SelectedTower) &&
        PlacedTowers[i].Name != "FOB"
      ) {
        PlacedTowers[i].DamageModifer -= SelectedTower.Damage;
      }
    }
  }
  if (GameMoney >= SelectedTower.Upgrade[index - 1]) {
    PlayUpgradeSound()
    GameMoney -= SelectedTower.Upgrade[index - 1];
    SelectedTower.Damage = SelectedTower.Upgrade[index - 4];
    SelectedTower.AttackSpeed = SelectedTower.Upgrade[index - 3];
    SelectedTower.Radius = SelectedTower.Upgrade[index - 2];
    SelectedTower.Level++;
    if (SelectedTower.Type == "Booster" && SelectedTower.Name == "FOB") {
      SelectedTower.OnUpgrade();
    }
    RefreshText();
  }
}

//Boost Towers have custom seling method
function SellTower() {
  PlayClick();
  let index = PlacedTowers.indexOf(SelectedTower);
  if (PlacedTowers[index].Type == "Booster") {
    PlacedTowers[index].SellTower();
  } else {
    GameMoney += SelectedTower.SellPrice;
    PlacedTowers.splice(index, 1);
    SelectedTower = false;
  }
}

//HAHAHHAH
//EACH TOWER HAS ITS OWN PLACING TOWER
//I CANT PASS INFO THROUGHT A BUTTONPRESSFUNCTION
//????
function PlaceStandardTower() {
  PlayClick();
  if (GameMoney >= Price.BasicTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new BasicTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
    SelectedTower = NewTowerType;
  }
}

function PlaceSniperTower() {
  PlayClick();
  if (GameMoney >= Price.SniperTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new SniperTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
    SelectedTower = NewTowerType;
  }
}

function PlaceMGTower() {
  PlayClick();
  if (GameMoney >= Price.MachinegunTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new MachinegunTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
    SelectedTower = NewTowerType;
  }
}

function PlaceMissleTower() {
  PlayClick();
  if (GameMoney >= Price.MissleLauncherTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new MissleTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
    SelectedTower = NewTowerType;
  }
}

function PlaceDroneTower() {
  PlayClick();
  if (GameMoney >= Price.Drone && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new DroneTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
    SelectedTower = NewTowerType;
  }
}

function PlaceWizardTower() {
  PlayClick();
  if (GameMoney >= Price.Wizard && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new WizardTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
    SelectedTower = NewTowerType;
  }
}

function PlaceFreezeTower() {
  PlayClick();
  if (GameMoney >= Price.FreezeTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new FreezeTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
    SelectedTower = NewTowerType;
  }
}

function PlaceNinjaTower() {
  PlayClick();
  if (GameMoney >= Price.NinjaTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new NinjaTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
    SelectedTower = NewTowerType;
  }
}

function PlaceDamageTower() {
  PlayClick();
  if (GameMoney >= Price.DamageTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new DamageTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
    SelectedTower = NewTowerType;
  }
}

function PlaceRadarTower() {
  PlayClick();
  if (GameMoney >= Price.RadarTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new RadarTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
    SelectedTower = NewTowerType;
  }
}

function PlaceAntiTankTower() {
  PlayClick();
  if (GameMoney >= Price.AntiTankTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new AntiTankTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
    SelectedTower = NewTowerType;
  }
}

//OMG FOR A SINGLE VAR
function DeselectTower() {
  PlayClick();
  if (SelectedTower.TowerPlaced == true) {
    SelectedTower = false;
  } else {
    let index = PlacedTowers.indexOf(SelectedTower);
    PlacedTowers.splice(index, 1);
    SelectedTower = false;
    DisablePlacing = false;
  }
}

function ChangeTargetMode() {
  PlayClick();
  if (SelectedTower) {
    if (SelectedTower.TargetMode == "first") {
      SelectedTower.TargetMode = "last";
    } else {
      SelectedTower.TargetMode = "first";
    }
  }
}

//Preload function to load images only once
//Also creates the shop buttons
//ok this was pretty smart
//but i dont want it inside setup

// Function to draw all game images to the screen
function DrawGameImages() {
  HeartImageScreen = image(HeartImageDirectory, 10, 10, 30, 30);
  MoneyStackScreen = image(MoneyStackDirectory, 95, 10, 30, 30);
}

// Function to draw all game text to the screen
function DrawGameText() {
  if (MapPlayed == 6) {
    fill(255);
  } else {
    fill(0);
  }
  HealthText = text(GameHealth, 50, 30);
  MoneyText = text(floor(GameMoney), 135, 30);
  fill(0);
  let FPSAmount = ceil(frameRate() / 5) * 5;
  FPS = text(FPSAmount, 520, 20);
  WaveText = text("Wave: " + WaveCount, 565, 385);
}

//THIS IS THE WORST THING IN THE ENTIRE FILE
//See for yourself
function CreateShop() {
  BasicTowerButton.show();
  SniperTowerButton.show();
  MachinegunTowerTowerButton.show();
  MissleLauncherButton.show();
  DroneTowerButton.show();
  WizardTowerButton.show();
  FreezeTowerButton.show();
  NinjaTowerButton.show();
  AntiTankTowerButton.show();
  DamageTowerButton.show();
  RadarTowerButton.show();
  PauseButton.show();

  BasicTowerButton.style("background-color", "gray");
  SniperTowerButton.style("background-color", "gray");
  MachinegunTowerTowerButton.style("background-color", "gray");
  MissleLauncherButton.style("background-color", "gray");
  DroneTowerButton.style("background-color", "gray");
  WizardTowerButton.style("background-color", "grey");
  FreezeTowerButton.style("background-color", "grey");
  NinjaTowerButton.style("background-color", "grey");
  AntiTankTowerButton.style("background-color", "grey");
  DamageTowerButton.style("background-color", "grey");
  RadarTowerButton.style("background-color", "grey");
  fill(10, 100, 100);
  square(550, 0, 600);

  if (GameMoney >= Price.BasicTower) {
    BasicTowerButton.style("background-color", "green");
  }

  if (GameMoney >= Price.SniperTower) {
    SniperTowerButton.style("background-color", "green");
  }

  if (GameMoney >= Price.MachinegunTower) {
    MachinegunTowerTowerButton.style("background-color", "green");
  }

  if (GameMoney >= Price.MissleLauncherTower) {
    MissleLauncherButton.style("background-color", "green");
  }

  if (GameMoney >= Price.Drone) {
    DroneTowerButton.style("background-color", "green");
  }

  if (GameMoney >= Price.Wizard) {
    WizardTowerButton.style("background-color", "purple");
  }

  if (GameMoney >= Price.FreezeTower) {
    FreezeTowerButton.style("background-color", "purple");
  }

  if (GameMoney >= Price.NinjaTower) {
    NinjaTowerButton.style("background-color", "purple");
  }

  if (GameMoney >= Price.DamageTower) {
    DamageTowerButton.style("background-color", "orange");
  }

  if (GameMoney >= Price.RadarTower) {
    RadarTowerButton.style("background-color", "orange");
  }

  if (GameMoney >= Price.AntiTankTower) {
    AntiTankTowerButton.style("background-color", "orange");
  }

  //Upgrade area
  line(550, 400, Xmax + ShopSize, 400);
  fill(0, 0, 0);
  if (SelectedTower === false) {
    UpgradeButton.hide();
    SellButton.hide();
  } else {
    if (SelectedTower.TowerPlaced == true) {
      UpgradeButton.style("display", "block");
      SellButton.style("display", "block");
      DeselectButton.style("display", "block");

      if (SelectedTower.Level > 3) {
        UpgradeButton.hide();
      }
      fill(0, 0, 0);
      RefreshText();
    }
  }
  if (SelectedTower) {
    DeselectButton.style("display", "block");
  } else {
    DeselectButton.hide();
  }
  if (SelectedTower && SelectedTower.TowerPlaced == true) {
    if (SelectedTower.TargetMode == "last") {
      FirstTargetButton.hide();
      LastTargetButton.style("display", "block");
    }
    if (SelectedTower.TargetMode == "first") {
      FirstTargetButton.style("display", "block");
      LastTargetButton.hide();
    }
  } else {
    LastTargetButton.hide();
    FirstTargetButton.hide();
  }
}
