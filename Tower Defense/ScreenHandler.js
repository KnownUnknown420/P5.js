/*⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠟⠛⠛⠛⠋⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠙⠛⠛⠛⠿⠻⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠋⠀⠀⠀⠀⠀⡀⠠⠤⠒⢂⣉⣉⣉⣑⣒⣒⠒⠒⠒⠒⠒⠒⠒⠀⠀⠐⠒⠚⠻⠿⠿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⠏⠀⠀⠀⠀⡠⠔⠉⣀⠔⠒⠉⣀⣀⠀⠀⠀⣀⡀⠈⠉⠑⠒⠒⠒⠒⠒⠈⠉⠉⠉⠁⠂⠀⠈⠙⢿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⠇⠀⠀⠀⠔⠁⠠⠖⠡⠔⠊⠀⠀⠀⠀⠀⠀⠀⠐⡄⠀⠀⠀⠀⠀⠀⡄⠀⠀⠀⠀⠉⠲⢄⠀⠀⠀⠈⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⠋⠀⠀⠀⠀⠀⠀⠀⠊⠀⢀⣀⣤⣤⣤⣤⣀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠜⠀⠀⠀⠀⣀⡀⠀⠈⠃⠀⠀⠀⠸⣿⣿⣿⣿
⣿⣿⣿⣿⡿⠥⠐⠂⠀⠀⠀⠀⡄⠀⠰⢺⣿⣿⣿⣿⣿⣟⠀⠈⠐⢤⠀⠀⠀⠀⠀⠀⢀⣠⣶⣾⣯⠀⠀⠉⠂⠀⠠⠤⢄⣀⠙⢿⣿⣿
⣿⡿⠋⠡⠐⠈⣉⠭⠤⠤⢄⡀⠈⠀⠈⠁⠉⠁⡠⠀⠀⠀⠉⠐⠠⠔⠀⠀⠀⠀⠀⠲⣿⠿⠛⠛⠓⠒⠂⠀⠀⠀⠀⠀⠀⠠⡉⢢⠙⣿
⣿⠀⢀⠁⠀⠊⠀⠀⠀⠀⠀⠈⠁⠒⠂⠀⠒⠊⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⢀⣀⡠⠔⠒⠒⠂⠀⠈⠀⡇⣿
⣿⠀⢸⠀⠀⠀⢀⣀⡠⠋⠓⠤⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠄⠀⠀⠀⠀⠀⠀⠈⠢⠤⡀⠀⠀⠀⠀⠀⠀⢠⠀⠀⠀⡠⠀⡇⣿
⣿⡀⠘⠀⠀⠀⠀⠀⠘⡄⠀⠀⠀⠈⠑⡦⢄⣀⠀⠀⠐⠒⠁⢸⠀⠀⠠⠒⠄⠀⠀⠀⠀⠀⢀⠇⠀⣀⡀⠀⠀⢀⢾⡆⠀⠈⡀⠎⣸⣿
⣿⣿⣄⡈⠢⠀⠀⠀⠀⠘⣶⣄⡀⠀⠀⡇⠀⠀⠈⠉⠒⠢⡤⣀⡀⠀⠀⠀⠀⠀⠐⠦⠤⠒⠁⠀⠀⠀⠀⣀⢴⠁⠀⢷⠀⠀⠀⢰⣿⣿
⣿⣿⣿⣿⣇⠂⠀⠀⠀⠀⠈⢂⠀⠈⠹⡧⣀⠀⠀⠀⠀⠀⡇⠀⠀⠉⠉⠉⢱⠒⠒⠒⠒⢖⠒⠒⠂⠙⠏⠀⠘⡀⠀⢸⠀⠀⠀⣿⣿⣿
⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠑⠄⠰⠀⠀⠁⠐⠲⣤⣴⣄⡀⠀⠀⠀⠀⢸⠀⠀⠀⠀⢸⠀⠀⠀⠀⢠⠀⣠⣷⣶⣿⠀⠀⢰⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠁⢀⠀⠀⠀⠀⠀⡙⠋⠙⠓⠲⢤⣤⣷⣤⣤⣤⣤⣾⣦⣤⣤⣶⣿⣿⣿⣿⡟⢹⠀⠀⢸⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣧⡀⠀⠀⠀⠀⠀⠀⠀⠑⠀⢄⠀⡰⠁⠀⠀⠀⠀⠀⠈⠉⠁⠈⠉⠻⠋⠉⠛⢛⠉⠉⢹⠁⢀⢇⠎⠀⠀⢸⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⣀⠈⠢⢄⡉⠂⠄⡀⠀⠈⠒⠢⠄⠀⢀⣀⣀⣰⠀⠀⠀⠀⠀⠀⠀⠀⡀⠀⢀⣎⠀⠼⠊⠀⠀⠀⠘⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣄⡀⠉⠢⢄⡈⠑⠢⢄⡀⠀⠀⠀⠀⠀⠀⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠁⠀⠀⢀⠀⠀⠀⠀⠀⢻⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣦⣀⡈⠑⠢⢄⡀⠈⠑⠒⠤⠄⣀⣀⠀⠉⠉⠉⠉⠀⠀⠀⣀⡀⠤⠂⠁⠀⢀⠆⠀⠀⢸⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣦⣄⡀⠁⠉⠒⠂⠤⠤⣀⣀⣉⡉⠉⠉⠉⠉⢀⣀⣀⡠⠤⠒⠈⠀⠀⠀⠀⣸⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣶⣤⣄⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣶⣶⣶⣤⣤⣤⣤⣀⣀⣤⣤⣤⣶⣾⣿⣿⣿⣿⣿*/
//I want to go back throught this and make it into class
//But this is much easier
//this code SUCKS!!!!!!!!!!
//I dont want to go back and fix it
//And theres dumb fixes eveywhere
//this shit is so disorginzed

// Text variables to store and display game data
let HealthText;
let MoneyText;
let BasicTowerPrice;
let FPS;

// Variables to store image directory and image objects
let HeartImageDirectory;
let HeartImageScreen;
let MoneyStackDirectory;
let MoneyStackScreen;

//shop buttons
let BasicTowerButton;
let SellTowerButton;
let DeselectButton;
let PauseButton;

//Price for the shop
let Price = {
  BasicTower: 200,
  SniperTower: 350,
  MachinegunTower: 600,
  MissleLauncherTower: 1200,
  Drone: 1500,
  Wizard: 600,
  FreezeTower: 500,
  NinjaTower: 600,
  DamageTower: 1500,
  RadarTower: 1500,
  AntiTankTower: 1500,
};

let ButtonColor;
let DisablePlacing = false;

//this function refreshes the tower data i guess???
function RefreshText() {
  if (SelectedTower.Level < 4) {
    text(SelectedTower.Upgrade[SelectedTower.Level * 4 - 1], 585, 530);
  }
  text(SelectedTower.Name, 560, 430);
  text("Level: " + SelectedTower.Level, 680, 430);
  text(
    "Damage: " + SelectedTower.Damage * SelectedTower.DamageModifer,
    680,
    460
  );
  text("Speed: " + SelectedTower.AttackSpeed, 680, 490);
  text("Kills: " + SelectedTower.KillCount, 680, 520);
}

//the ONE ONLY dynamic function in this enitre shop thingy
function UpgradeTower() {
  let index = SelectedTower.Level * 4;
  if (SelectedTower.Type == "Booster") {
    for (let i = 0; i < PlacedTowers.length; i++) {
      if (
        PlacedTowers[i].BoostedBy.includes(SelectedTower) &&
        PlacedTowers[i].Name != "FOB"
      ) {
        PlacedTowers[i].DamageModifer -= SelectedTower.Damage;
      }
    }
  }
  if (GameMoney >= SelectedTower.Upgrade[index - 1]) {
    GameMoney -= SelectedTower.Upgrade[index - 1];
    SelectedTower.Damage = SelectedTower.Upgrade[index - 4];
    SelectedTower.AttackSpeed = SelectedTower.Upgrade[index - 3];
    SelectedTower.Radius = SelectedTower.Upgrade[index - 2];
    SelectedTower.Level++;
    if (SelectedTower.Type == "Booster") {
      SelectedTower.OnUpgrade();
    }
    RefreshText();
  }
}

//make this the second one, sells stuff
//Boost Towers have custom seling method
function SellTower() {
  let index = PlacedTowers.indexOf(SelectedTower);
  if (PlacedTowers[index].Type == "Booster") {
    PlacedTowers[index].SellTower();
  } else {
    GameMoney += SelectedTower.SellPrice;
    PlacedTowers.splice(index, 1);
    SelectedTower = false;
  }
}

//HAHAHHAH
//EACH TOWER HAS ITS OWN PLACING TOWER
//I CANT PASS INFO THROUGHT A BUTTONPRESSFUNCTION
//????
function PlaceStandardTower() {
  if (GameMoney >= Price.BasicTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new BasicTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
  }
}

function PlaceSniperTower() {
  if (GameMoney >= Price.SniperTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new SniperTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
  }
}

function PlaceMGTower() {
  if (GameMoney >= Price.MachinegunTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new MachinegunTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
  }
}

function PlaceMissleTower() {
  if (GameMoney >= Price.MissleLauncherTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new MissleTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
  }
}

function PlaceDroneTower() {
  if (GameMoney >= Price.Drone && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new DroneTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
  }
}

function PlaceWizardTower() {
  if (GameMoney >= Price.Wizard && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new WizardTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
  }
}

function PlaceFreezeTower() {
  if (GameMoney >= Price.FreezeTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new FreezeTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
  }
}

function PlaceNinjaTower() {
  if (GameMoney >= Price.BasicTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new NinjaTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
  }
}

function PlaceDamageTower() {
  if (GameMoney >= Price.BasicTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new DamageTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
  }
}

function PlaceRadarTower() {
  if (GameMoney >= Price.BasicTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new RadarTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
  }
}

function PlaceAntiTankTower() {
  if (GameMoney >= Price.AntiTankTower && DisablePlacing == false) {
    SelectedTower = false;
    DisablePlacing = true;
    let NewTowerType = new AntiTankTower();
    NewTowerType.PlaceTower();
    NewTowerType.PushToList();
  }
}

//OMG FOR A SINGLE VAR
function DeselectTower() {
  SelectedTower = false;
}

//Preload function to load images only once
//Also creates the shop buttons
//ok this was pretty smart
//but i dont want it inside setup
function preload() {
  HeartImageDirectory = loadImage("Images/Heart.png");
  MoneyStackDirectory = loadImage("Images/STACK.png");

  PauseButton = createButton("Pause");
  PauseButton.style("background-color", "green");
  PauseButton.position(455, 600);
  PauseButton.size(95, 50);
  PauseButton.mousePressed(PauseGame);

  UpgradeButton = createButton("Upgrade");
  UpgradeButton.style("background-color", "rgb(0,115,255)");
  UpgradeButton.position(555, 445);
  UpgradeButton.size(105, 50);
  UpgradeButton.mousePressed(UpgradeTower);

  SellButton = createButton("Sell");
  SellButton.style("background-color", "gold");
  SellButton.position(693, 545);
  SellButton.size(105, 50);
  SellButton.mousePressed(SellTower);

  DeselectButton = createButton("Deselect");
  DeselectButton.style("background-color", "red");
  DeselectButton.position(555, 545);
  DeselectButton.size(105, 50);
  DeselectButton.mousePressed(DeselectTower);

  BasicTowerButton = createButton("($" + Price.BasicTower + ") Soilder");
  BasicTowerButton.style("background-color", "grey");
  BasicTowerButton.position(560, 10);
  BasicTowerButton.size(95, 50);
  BasicTowerButton.mousePressed(PlaceStandardTower);

  SniperTowerButton = createButton("($" + Price.SniperTower + ") Sniper");
  SniperTowerButton.style("background-color", "grey");
  SniperTowerButton.position(690, 10);
  SniperTowerButton.size(95, 50);
  SniperTowerButton.mousePressed(PlaceSniperTower);

  MachinegunTowerTowerButton = createButton(
    "($" + Price.MachinegunTower + ") Machine gun"
  );
  MachinegunTowerTowerButton.style("background-color", "grey");
  MachinegunTowerTowerButton.position(560, 70);
  MachinegunTowerTowerButton.size(95, 50);
  MachinegunTowerTowerButton.mousePressed(PlaceMGTower);

  MissleLauncherButton = createButton(
    "($" + Price.MissleLauncherTower + ") Tank"
  );
  MissleLauncherButton.style("background-color", "grey");
  MissleLauncherButton.position(690, 70);
  MissleLauncherButton.size(95, 50);
  MissleLauncherButton.mousePressed(PlaceMissleTower);

  DroneTowerButton = createButton("($" + Price.Drone + ") Drone");
  DroneTowerButton.style("background-color", "grey");
  DroneTowerButton.position(560, 130);
  DroneTowerButton.size(95, 50);
  DroneTowerButton.mousePressed(PlaceDroneTower);

  WizardTowerButton = createButton("($" + Price.Wizard + ") Wizard");
  WizardTowerButton.style("background-color", "grey");
  WizardTowerButton.position(690, 130);
  WizardTowerButton.size(95, 50);
  WizardTowerButton.mousePressed(PlaceWizardTower);

  FreezeTowerButton = createButton("($" + Price.FreezeTower + ") Freeze");
  FreezeTowerButton.style("background-color", "grey");
  FreezeTowerButton.position(560, 190);
  FreezeTowerButton.size(95, 50);
  FreezeTowerButton.mousePressed(PlaceFreezeTower);

  NinjaTowerButton = createButton("($" + Price.NinjaTower + ")  Ninja");
  NinjaTowerButton.style("background-color", "grey");
  NinjaTowerButton.position(690, 190);
  NinjaTowerButton.size(95, 50);
  NinjaTowerButton.mousePressed(PlaceNinjaTower);

  DamageTowerButton = createButton("($" + Price.DamageTower + ")  FOB");
  DamageTowerButton.style("background-color", "grey");
  DamageTowerButton.position(560, 250);
  DamageTowerButton.size(95, 50);
  DamageTowerButton.mousePressed(PlaceDamageTower);

  RadarTowerButton = createButton("($" + Price.RadarTower + ")  Radar");
  RadarTowerButton.style("background-color", "grey");
  RadarTowerButton.position(690, 250);
  RadarTowerButton.size(95, 50);
  RadarTowerButton.mousePressed(PlaceRadarTower);

  AntiTankTowerButton = createButton(
    "($" + Price.AntiTankTower + ")  Anti Tank"
  );
  AntiTankTowerButton.style("background-color", "grey");
  AntiTankTowerButton.position(560, 310);
  AntiTankTowerButton.size(95, 50);
  AntiTankTowerButton.mousePressed(PlaceAntiTankTower);
}

// Function to draw all game images to the screen
function DrawGameImages() {
  HeartImageScreen = image(HeartImageDirectory, 10, 10, 30, 30);
  MoneyStackScreen = image(MoneyStackDirectory, 95, 10, 30, 30);
}

// Function to draw all game text to the screen
function DrawGameText() {
  HealthText = text(GameHealth, 50, 30);
  MoneyText = text(GameMoney, 135, 30);
  let FPSAmount = ceil(frameRate() / 5) * 5;
  FPS = text(FPSAmount, 520, 30);
}

// Function to reset the button colors
//EACH BUTTON
//ONE BY ONE
function ResetColors() {
  BasicTowerButton.style("background-color", "gray");
  SniperTowerButton.style("background-color", "gray");
  MachinegunTowerTowerButton.style("background-color", "gray");
  MissleLauncherButton.style("background-color", "gray");
  DroneTowerButton.style("background-color", "gray");
  WizardTowerButton.style("background-color", "grey");
  FreezeTowerButton.style("background-color", "grey");
  NinjaTowerButton.style("background-color", "grey");
  AntiTankTowerButton.style("background-color", "grey");
}

//THIS IS THE WORST THING IN THE ENTIRE FILE
//See for yourself
function CreateShop() {
  ResetColors();
  fill(10, 100, 100);
  square(550, 0, 600);

  if (GameMoney >= Price.BasicTower) {
    BasicTowerButton.style("background-color", "green");
  }

  if (GameMoney >= Price.SniperTower) {
    SniperTowerButton.style("background-color", "green");
  }

  if (GameMoney >= Price.MachinegunTower) {
    MachinegunTowerTowerButton.style("background-color", "green");
  }

  if (GameMoney >= Price.MissleLauncherTower) {
    MissleLauncherButton.style("background-color", "green");
  }

  if (GameMoney >= Price.Drone) {
    DroneTowerButton.style("background-color", "green");
  }

  if (GameMoney >= Price.Wizard) {
    WizardTowerButton.style("background-color", "purple");
  }

  if (GameMoney >= Price.FreezeTower) {
    FreezeTowerButton.style("background-color", "purple");
  }

  if (GameMoney >= Price.NinjaTower) {
    NinjaTowerButton.style("background-color", "purple");
  }

  if (GameMoney >= Price.DamageTower) {
    DamageTowerButton.style("background-color", "orange");
  }

  if (GameMoney >= Price.RadarTower) {
    RadarTowerButton.style("background-color", "orange");
  }

  if (GameMoney >= Price.AntiTankTower) {
    AntiTankTowerButton.style("background-color", "orange");
  }

  //Upgrade area
  line(550, 400, Xmax + ShopSize, 400);
  fill(0, 0, 0);
  if (SelectedTower === false) {
    UpgradeButton.hide();
    SellButton.hide();
    DeselectButton.hide();
  } else {
    UpgradeButton.style("display", "block");
    SellButton.style("display", "block");
    DeselectButton.style("display", "block");

    if (SelectedTower.Level > 3) {
      UpgradeButton.hide();
    }
    fill(0, 0, 0);
    RefreshText();
  }
}
